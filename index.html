<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Nhập Liệu Phiếu Hàng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container-fluid">
        <header>
            <h1><i class="fas fa-truck"></i>Phiếu nhập hàng</h1>
        </header>

        <div class="main-content">
            <div class="cart-header">
                <div class="stats-control">
                    <label for="routeSelector">Chọn tuyến đường:</label>
                    <select id="routeSelector">
                        <option value="">-- Chọn tuyến đường --</option>
                    </select>
                </div>
                <div class="cart-stats">
                    <div class="stat-card">
                        <h3>Tổng số đơn</h3>
                        <div class="stat-value" id="totalOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Tổng trọng lượng (kg)</h3>
                        <div class="stat-value" id="totalWeight">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Tổng khối lượng (m³)</h3>
                        <div class="stat-value" id="totalVolume">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Số xe cần dùng</h3>
                        <div class="stat-value" id="totalVehicles">0</div>
                    </div>
                </div>
            </div>

            <section class="list-section">
                <h2><i class="fas fa-list"></i> Danh Sách Đơn Hàng</h2>

                <div id="ordersTableContainer">
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>Ngày Tạo</th>
                                <th>Khách Hàng</th>
                                <th>Cửa hàng</th>
                                <th>Tuyến Đường</th>
                                <th>Số Xe</th>
                                <th>Số Kiện</th>
                                <th>Trọng Lượng (kg)</th>
                                <th>Khối Lượng (m³)</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dữ liệu sẽ được thêm động bằng JS -->
                        </tbody>
                    </table>

                    <div class="empty-state" id="emptyState">
                        <i class="fas fa-inbox"></i>
                        <h3>Chưa có đơn hàng nào</h3>
                        <p>Hãy bắt đầu bằng cách tạo đơn hàng mới</p>
                    </div>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Nút phân trang sẽ được thêm bằng JS -->
                </div>
            </section>

            <section class="input-section">
                <h2><i class="fas fa-plus-circle"></i> Nhập Phiếu Mới</h2>
                <form id="inputForm">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3><i class="fas fa-user"></i> Thông Tin Khách Hàng</h3>

                            <div class="form-group">
                                <label for="customerInput" class="required-label">Khách Hàng:</label>
                                <div class="autocomplete">
                                    <input type="text" id="customerInput" placeholder="Nhập tên khách hàng...">
                                    <div id="customerSuggestions" class="autocomplete-suggestions hidden"></div>
                                </div>
                                <div class="error-message" id="customerError">Vui lòng nhập tên khách hàng</div>
                            </div>

                            <div class="form-group">
                                <label for="storeInput">Cửa hàng/Chi nhánh:</label>
                                <div class="autocomplete">
                                    <input type="text" id="storeInput" placeholder="Nhập tên cửa hàng/chi nhánh...">
                                    <div id="storeSuggestions" class="autocomplete-suggestions hidden"></div>
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="newCustomer">
                                <label for="newCustomer">Khách hàng mới</label>
                            </div>

                            <div id="newCustomerForm" class="hidden">
                                <div class="form-group">
                                    <input type="text" id="newName" placeholder="Tên khách hàng mới">
                                    <div class="error-message" id="newNameError">Vui lòng nhập tên khách hàng mới</div>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="newAddress" placeholder="Địa chỉ">
                                </div>
                                <div class="form-group">
                                    <input type="text" id="newPhone" placeholder="Số điện thoại">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-route"></i> Thông Tin Tuyến Đường</h3>

                            <div class="form-group">
                                <label for="routeInput" class="required-label">Tuyến Đường:</label>
                                <div class="autocomplete">
                                    <input type="text" id="routeInput"
                                        placeholder="Nhập tuyến (ví dụ: HCM HN cho Hồ Chí Minh -> Hà Nội)">
                                    <div id="routeSuggestions" class="autocomplete-suggestions hidden"></div>
                                </div>
                                <div class="error-message" id="routeError">Vui lòng nhập tuyến đường</div>
                            </div>

                            <div class="route-display hidden" id="routeDisplay">
                                <i class="fas fa-route"></i> Tuyến đường: <span id="routeText"></span>
                            </div>
                            <div class="form-group">
                                <label for="vehicleInput" class="required-label">Số xe:</label>
                                <div class="autocomplete">
                                    <input type="text" id="vehicleInput" placeholder="Nhập số xe hoặc tên tài xế">
                                    <div id="vehicleSuggestions" class="autocomplete-suggestions hidden"></div>
                                </div>
                                <div class="error-message" id="vehicleInputError">Vui lòng nhập số xe</div>
                            </div>
                            <div class="vehicle-display hidden" id="vehicleDisplay">
                                <i class="fas fa-route"></i> Số xe: <span id="vehicleText"></span>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="customPickup">
                                <label for="customPickup">Lấy hàng tận nơi</label>
                            </div>

                            <div id="pickupAddress" class="hidden">
                                <div class="form-group">
                                    <input type="text" id="pickupAddr" placeholder="Địa chỉ lấy hàng">
                                </div>
                                <div class="compact-grid">
                                    <div class="form-group">
                                        <input type="text" id="pickupContact" placeholder="Người liên lạc">
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="pickupPhone" placeholder="Số điện thoại">
                                    </div>
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="customDelivery">
                                <label for="customDelivery">Giao hàng tận nơi</label>
                            </div>

                            <div id="deliveryAddress" class="hidden">
                                <div class="form-group">
                                    <input type="text" id="deliveryAddr" placeholder="Địa chỉ giao hàng">
                                </div>
                                <div class="compact-grid">
                                    <div class="form-group">
                                        <input type="text" id="deliveryContact" placeholder="Người liên lạc">
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="deliveryPhone" placeholder="Số điện thoại">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-box"></i> Thông Tin Hàng Hóa</h3>

                        <div class="cargo-inputs-container"
                            style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <div class="cargo-type">
                                <h4><i class="fas fa-snowflake"></i> Hàng Đông</h4>
                                <div class="cargo-inputs">
                                    <div class="form-group">
                                        <input type="number" placeholder="Số kiện" class="pkg frozen">
                                    </div>
                                    <div class="form-group">
                                        <input type="number" placeholder="Số kg" class="kg frozen">
                                    </div>
                                    <div class="form-group">
                                        <input type="number" placeholder="Khối (m³)" class="vol frozen">
                                    </div>
                                    <div class="form-group">
                                        <select placeholder="Đơn vị" class="dry">
                                            <option value="kg">Kilogram</option>
                                            <option value="m3">Mét khối</option>
                                            <option value="pallet">Pallet</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" placeholder="Ghi chú" class="frozen">
                                </div>
                            </div>

                            <div class="cargo-type">
                                <h4><i class="fas fa-cloud-sun"></i> Hàng Mát</h4>
                                <div class="cargo-inputs">
                                    <div class="form-group">
                                        <input type="number" placeholder="Số kiện" class="pkg cool">
                                    </div>
                                    <div class="form-group">
                                        <input type="number" placeholder="Số kg" class="kg cool">
                                    </div>
                                    <div class="form-group">
                                        <input type="number" placeholder="Khối (m³)" class="vol cool">
                                    </div>
                                    <div class="form-group">
                                        <select placeholder="Đơn vị" class="dry">
                                            <option value="kg">Kilogram</option>
                                            <option value="m3">Mét khối</option>
                                            <option value="pallet">Pallet</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" placeholder="Ghi chú" class="cool">
                                </div>
                            </div>

                            <div class="cargo-type">
                                <h4><i class="fas fa-sun"></i> Hàng Khô</h4>
                                <div class="cargo-inputs">
                                    <div class="form-group">
                                        <input type="number" placeholder="Số kiện" class="pkg dry">
                                    </div>
                                    <div class="form-group">
                                        <input type="number" placeholder="Số kg" class="kg dry">
                                    </div>
                                    <div class="form-group">
                                        <input type="number" placeholder="Khối (m³)" class="vol dry">
                                    </div>
                                    <div class="form-group">
                                        <select placeholder="Đơn vị" class="dry">
                                            <option value="kg">Kilogram</option>
                                            <option value="m3">Mét khối</option>
                                            <option value="pallet">Pallet</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" placeholder="Ghi chú" class="dry">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="reset" class="btn btn-reset"><i class="fas fa-redo"></i> Làm Mới</button>
                        <button type="submit" class="btn btn-submit"><i class="fas fa-save"></i> Tạo Phiếu</button>
                        <button type="button" class="btn btn-export" id="exportExcel"><i class="fas fa-file-excel"></i>
                            Export Excel</button>
                        <button type="button" class="btn btn-warning" id="clearData"
                            style="background-color: #f39c12;"><i class="fas fa-trash"></i> Xóa Dữ Liệu</button>
                    </div>
                </form>
            </section>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Phiếu hàng đã được tạo thành công!</span>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script>
        // Dữ liệu mẫu
        const customers = [
            { name: "CÔNG TY TNHH BÁNH NGỌT CJ VIỆT NAM", address: "Số 3,5,7 Nguyễn Huệ, P. Bến Nghé,Q. 1", email: "acbdd01@gmail.com", phone: "088793292", code_number: "CQ100718" },
            { name: "CÔNG TY TNHH PHÂN PHỐI PLATINUM BEVERAGES", address: "162 Trần Hưng Đạo, P. Nguyễn Cư Trinh, Q. 1", email: "acbdd02@gmail.com", phone: "019199488", code_number: "CQ104420" },
            { name: "CÔNG TY TNHH HIKARI VIỆT NAM", address: "Tầng 3 AEON Mall Tân Phú, 30 Bờ Bao Tân Thắng, Q. Tân Phú", email: "acbdd03@gmail.com", phone: "025497914", code_number: "CQ100008" },
            { name: "CÔNG TY TNHH HOÀNG GIA VI", address: "Số SB8-1, Mỹ Khánh 2, Nguyễn Đức Cảnh, Q. 7", email: "acbdd04@gmail.com", phone: "094625774", code_number: "CQ106673" },
            { name: "CÔNG TY CỔ PHẦN THƯƠNG MẠI DUY ANH", address: "12 Lê Quý Đôn, P. Võ Thị Sáu, Q. 3", email: "acbdd05@gmail.com", phone: "097271546", code_number: "SQ102286" },
            { name: "CÔNG TY TNHH MEGA VIỆT PHÁT", address: "Số 52 Võ Văn Tần, P. Võ Thị Sáu Q. 3", email: "acbdd06@gmail.com", phone: "053382878", code_number: "CQ104607" },
            { name: "CHI NHÁNH CÔNG TY TNHH VẬN TẢI VIỆT NHẬT", address: "46Ter Võ Văn Tần, Phường Võ Thị Sáu, Quận 3", email: "acbdd07@gmail.com", phone: "069603890", code_number: "CQ100106" },
            { name: "CÔNG TY TNHH FUJI SEAL VIỆT NAM", address: "95 Cao Thắng,P. 3, Q. 3", email: "acbdd08@gmail.com", phone: "048758536", code_number: "CQ103082" },
            { name: "CÔNG TY TNHH HOÀI GIANG XANH", address: "Số 16 Lê Quý Đôn, P. 6, Q. 3", email: "acbdd09@gmail.com", phone: "037253985", code_number: "CQ104104" },
            { name: "CÔNG TY TNHH ĐẦU TƯ THƯƠNG MẠI VÀ DỊCH VỤ PDS", address: "Số 111 đường Hồ Tùng Mậu, P. Bến Nghé, Q. 1", email: "acbdd10@gmail.com", phone: "078579892", code_number: "CQ108614" },
            { name: "CÔNG TY TNHH THƯƠNG MẠI & DỊCH VỤ DUY TÂN", address: "TTTM Aeon Mall, Số 30 Bờ Bao Tân Thắng, P. Sơn Kỳ, Q. Tân Phú", email: "acbdd11@gmail.com", phone: "092784872", code_number: "CQ108607" },
            { name: "CHI NHÁNH CÔNG TY TNHH AN DUYÊN", address: "Số 163 Cô Giang, P. Cô Giang, Q. 1", email: "acbdd12@gmail.com", phone: "045999669", code_number: "CQ103902" },
            { name: "CÔNG TY TNHH PHÂN PHỐI SÀNH ĐIỆU - CHI NHÁNH HÀ NỘI", address: "Tầng 12, Khách sạn La Siesta Premium Sài Gòn, Số 180-188 Lý Tự Trọng, P. Bến Thành, Q. 1", email: "acbdd13@gmail.com", phone: "029115379", code_number: "CQ105266" },
            { name: "CÔNG TY CỔ PHẦN THƯƠNG MẠI DỊCH VỤ SẢN XUẤT HƯƠNG THỦY", address: "28 Phạm Ngọc Thạch, P. 6, Q. 3", email: "acbdd14@gmail.com", phone: "043073439", code_number: "CQ102406" },
            { name: "CÔNG TY TNHH CƠ HỘI  VÀ THÁCH THỨC", address: "63B Hoàng Hoa Thám, P. 13, Q. Tân Bình", email: "acbdd15@gmail.com", phone: "013035221", code_number: "CQ103343" },
            { name: "CÔNG TY CỔ PHẦN ĐẠI TÂN VIỆT", address: "Số 293 - 293B Trần Hưng Đạo, P. Cô Giang, Q.1", email: "acbdd16@gmail.com", phone: "094354624", code_number: "CQ100232" },
            { name: "CÔNG TY TNHH MỘT THÀNH VIÊN CAN DO", address: "466 Nguyễn Tri Phương, P. 9, Q. 10", email: "acbdd17@gmail.com", phone: "072449621", code_number: "CQ103240" },
            { name: "CÔNG TY CỔ PHẦN THỰC PHẨM CHOLIMEX (CHOLIMEX FOOD JSC)", address: "140A Đường Lý Chính Thắng, P. Võ Thị Sáu, Q. 3", email: "acbdd18@gmail.com", phone: "042617537", code_number: "CQ101932" },
            { name: "CÔNG TY CỔ PHẦN THƯƠNG MẠI PHAN NAM MON TE RO SA", address: "5 Nguyễn Tất Thành, P. 12, Q. 4", email: "acbdd19@gmail.com", phone: "016777964", code_number: "CQ104579" },
            { name: "CÔNG TY TNHH KEWPIE VIỆT NAM", address: "tầng 5, Khách Sạn Palace Saigon, 56-66 Nguyễn Huệ, P. Bến Nghé, Q. 1", email: "acbdd20@gmail.com", phone: "082480876", code_number: "CQ103019" },
            { name: "CÔNG TY TNHH LEGENDARY VIỆT NAM", address: "235 Phan Xích Long, P.2, Q. Phú Nhuận", email: "acbdd21@gmail.com", phone: "046724791", code_number: "CQ103830" },
            { name: "CÔNG TY CỔ PHẦN TẬP ĐOÀN GOLDEN GATE - CHI NHÁNH MIỀN BẮC", address: "351 Nguyễn Thượng Hiền, P. 11, Q. 3", email: "acbdd22@gmail.com", phone: "012431103", code_number: "CQ107217" },
            { name: "CÔNG TY TNHH VỊ NGUYÊN", address: "27 Tú Xương, P. 7, Q. 3", email: "acbdd23@gmail.com", phone: "060000221", code_number: "CQ103540" },
            { name: "CÔNG TY TNHH THẾ GIỚI KEM", address: "số 57 Võ Văn Tần, P. 6, Q. 3", email: "acbdd24@gmail.com", phone: "070021397", code_number: "CQ103503" },
            { name: "CÔNG TY TNHH KOYU & UNITEK", address: "150/26 Nguyễn Trãi, P. Bến Thành, Q. 1", email: "acbdd25@gmail.com", phone: "072566637", code_number: "CQ103449" },
            { name: "CÔNG TY TNHH OKAMURA TRADING VIỆT NAM", address: "Lầu 1, Khách sạn Viễn Đông, số 275A Phạm Ngũ Lão, P. Bến Thành, Q.1", email: "acbdd26@gmail.com", phone: "032318192", code_number: "CQ108365" },
            { name: "CÔNG TY TNHH LOTTE VINA INTERNATIONAL", address: "109/6 Nguyễn Thiện Thuật, P. 2, Q. 3", email: "acbdd27@gmail.com", phone: "088536922", code_number: "CQ103694" },
            { name: "CÔNG TY CỔ PHẦN ÔNG GIÀ IKA", address: "Số 5 Phạm Ngọc Thạch, Phường Xuân Hòa", email: "acbdd28@gmail.com", phone: "077904920", code_number: "CQ104350" },
            { name: "Chi Nhánh Công Ty TNHH Thương Mại Hoàng Lê Thành Phố Hồ Chí Minh", address: "281 - 283 Nguyễn Trãi, P. Nguyễn Cư Trinh, Q. 1", email: "acbdd29@gmail.com", phone: "091881165", code_number: "CQ105110" },
            { name: "CÔNG TY TNHH IMANAKA (VIỆT NAM)", address: "6B Công Trường Quốc Tế, P. 6, Q. 3", email: "acbdd30@gmail.com", phone: "034178375", code_number: "CQ103760" },
            { name: "CHI NHÁNH CÔNG TY TNHH FOODSCOM", address: "20 Trần Cao Vân, P. Đa Kao, Q. 1", email: "acbdd31@gmail.com", phone: "097268184", code_number: "CQ102050" },
            { name: "CHI NHÁNH CÔNG TY TNHH THƯ MỤC BẾP VN TẠI ĐÀ NẴNG", address: "Số 764 Sư Vạn Hạnh, P. 12, Q. 10", email: "acbdd32@gmail.com", phone: "083856471", code_number: "CQ108017" },
            { name: "CHI NHÁNH CÔNG TY TNHH THƯ MỤC BẾP VN", address: "Số 457 Sư Vạn Hạnh, P. 12, Q.10", email: "acbdd33@gmail.com", phone: "012324266", code_number: "CQ108279" },
            { name: "CÔNG TY TNHH THỰC PHẨM XANH MINH PHÚ", address: "Số 102-104, Mạc Thị Bưởi, P. Bến Nghé, Q. 1", email: "acbdd34@gmail.com", phone: "055657041", code_number: "CQ104759" },
            { name: "CÔNG TY CỔ PHẦN CHUỖI NHÀ HÀNG SVN", address: "Số 172-173 Bến Vân Đồn, P. 6, Q. 4", email: "acbdd35@gmail.com", phone: "077106437", code_number: "CQ107573" },
            { name: "CHI NHÁNH 13-CÔNG TY TNHH MỘT THÀNH VIÊN PHỔ ĐÌNH (TP ĐÀ NẴNG)", address: "Số 78 Nguyễn Đình Chiểu, P.Đa Kao, Q.1", email: "acbdd36@gmail.com", phone: "033886792", code_number: "CQ103730" },
            { name: "CÔNG TY CỔ PHẦN TẬP ĐOÀN GOLDEN GATE - CHI NHÁNH MIỀN NAM", address: "35-37 Ngô Đức Kế, P. Bến Nghé, Q. 1", email: "acbdd37@gmail.com", phone: "072617533", code_number: "CQ104069" },
            { name: "CÔNG TY TNHH SẢN XUẤT THƯƠNG MẠI VÀ XUẤT KHẨU THÀNH TRUNG", address: "32 Hoa Mai, P. 2, Q. Phú Nhuận", email: "acbdd38@gmail.com", phone: "059279372", code_number: "CQ108849" },
            { name: "CÔNG TY TNHH KANEMATSU VIỆT NAM", address: "357 Lê Văn Sỹ, P. 01, Q. Tân Bình", email: "acbdd39@gmail.com", phone: "039431214", code_number: "CQ104125" },
            { name: "CÔNG TY TNHH PHÂN PHỐI VÀ DỊCH VỤ HANN", address: "Số 40/13 Nguyễn Văn Đậu, P. 6, Q. Bình Thạnh", email: "acbdd40@gmail.com", phone: "054101301", code_number: "CQ105838" },
            { name: "CÔNG TY TNHH YAKULT VIỆT NAM", address: "54 Thuận Kiều, P. 4, Q. 11", email: "acbdd41@gmail.com", phone: "025730779", code_number: "CQ103072" },
            { name: "CÔNG TY TNHH THỰC PHẨM ÂN NAM", address: "Tầng 3, Số 411 Trần Hưng Đạo B, P. 14, Q. 5", email: "acbdd42@gmail.com", phone: "024388805", code_number: "CQ102684" },
            { name: "CHI NHÁNH CÔNG TY TNHH THƯƠNG MẠI VÀ DỊCH VỤ NHÀ HÀNG BIA THỦ CÔNG PASTEUR STREET TẠI HÀ NỘI", address: "Số 9A Lam Sơn, P. 2, Q. Tân Bình", email: "acbdd43@gmail.com", phone: "091035602", code_number: "CQ106728" },
            { name: "CÔNG TY TNHH THỰC PHẨM VÀ NƯỚC GIẢI KHÁT COOL SMOOTHIE", address: "số 383 Điện Biên Phủ, P. 25, Q. Bình Thạnh", email: "acbdd44@gmail.com", phone: "034435905", code_number: "CQ107687" },
            { name: "CÔNG TY TNHH LOTTE VIỆT NAM", address: "185 - 187 Kênh Tân Hoá, P. Hoà Thạnh, Q. Tân Phú", email: "acbdd45@gmail.com", phone: "067852638", code_number: "CQ100712" },
            { name: "CÔNG TY CỔ PHẦN SÔCÔLA MAROU", address: "48Bis Xuân Thủy, P. Thảo Điền, Q. 2", email: "acbdd46@gmail.com", phone: "032357377", code_number: "CQ100686" },
            { name: "CÔNG TY TNHH DỪA CƯỜI", address: "Tầng 12, Khách sạn La Siesta Premium Sài Gòn, Số 180-188 Lý Tự Trọng, P. Bến Thành, Q. 1", email: "acbdd47@gmail.com", phone: "070082419", code_number: "CQ103810" },
            { name: "CÔNG TY CỔ PHẦN NÔNG SẢN THỰC PHẨM LÂM ĐỒNG", address: "28 Phạm Ngọc Thạch, P. 6, Q. 3", email: "acbdd48@gmail.com", phone: "055533754", code_number: "CQ100354" },
            { name: "CÔNG TY CỔ PHẦN GOURMET PARTNER VIỆT NAM", address: "63B Hoàng Hoa Thám, P. 13, Q. Tân Bình", email: "acbdd49@gmail.com", phone: "073150716", code_number: "SQ105557" },
            { name: "CÔNG TY TNHH THỰC PHẨM NGON CỔ ĐIỂN", address: "Số 293 - 293B Trần Hưng Đạo, P. Cô Giang, Q.1", email: "acbdd50@gmail.com", phone: "055198647", code_number: "CQ103241" },
            { name: "CÔNG TY TNHH LOGISALL POOLING SERVICES VIỆT NAM", address: "466 Nguyễn Tri Phương, P. 9, Q. 10", email: "acbdd51@gmail.com", phone: "088583487", code_number: "CQ105478" },
            { name: "CÔNG TY TNHH AEON TOPVALU VIỆT NAM", address: "140A Đường Lý Chính Thắng, P. Võ Thị Sáu, Q. 3", email: "acbdd52@gmail.com", phone: "089338944", code_number: "CQ100675" },
            { name: "CÔNG TY TNHH PHÂN PHỐI SÀNH ĐIỆU", address: "5 Nguyễn Tất Thành, P. 12, Q. 4", email: "acbdd53@gmail.com", phone: "016327835", code_number: "CQ101938" },
            { name: "CÔNG TY CỔ PHẦN QUỐC TẾ HOA DOANH", address: "tầng 5, Khách Sạn Palace Saigon, 56-66 Nguyễn Huệ, P. Bến Nghé, Q. 1", email: "acbdd54@gmail.com", phone: "039359206", code_number: "CQ107493" },
            { name: "CÔNG TY TNHH KOME88", address: "235 Phan Xích Long, P.2, Q. Phú Nhuận", email: "acbdd55@gmail.com", phone: "072224229", code_number: "CQ104548" },
            { name: "CÔNG TY TNHH HANWA VIỆT NAM", address: "351 Nguyễn Thượng Hiền, P. 11, Q. 3", email: "acbdd56@gmail.com", phone: "047918838", code_number: "CQ103925" },
            { name: "CHI NHÁNH CÔNG TY TNHH DỊCH VỤ THỰC PHẨM INDOGUNA VINA TẠI HÀ NỘI", address: "27 Tú Xương, P. 7, Q. 3", email: "acbdd57@gmail.com", phone: "086022366", code_number: "CQ103595" },
            { name: "CÔNG TY TNHH DỊCH VỤ THỰC PHẨM INDOGUNA VINA", address: "số 57 Võ Văn Tần, P. 6, Q. 3", email: "acbdd58@gmail.com", phone: "018775791", code_number: "CQ103480" },
            { name: "CÔNG TY TNHH SAN MIGUEL PURE FOODS (VN)", address: "150/26 Nguyễn Trãi, P. Bến Thành, Q. 1", email: "acbdd59@gmail.com", phone: "095498998", code_number: "CQ103003" },
            { name: "CÔNG TY TNHH THỰC PHẨM SẠCH THƯƠNG MẠI T&P", address: "Lầu 1, Khách sạn Viễn Đông, số 275A Phạm Ngũ Lão, P. Bến Thành, Q.1", email: "acbdd60@gmail.com", phone: "094545513", code_number: "CQ103928" },
            { name: "CÔNG TY TNHH MTV KITCHEN 4PS", address: "109/6 Nguyễn Thiện Thuật, P. 2, Q. 3", email: "acbdd61@gmail.com", phone: "025041664", code_number: "CQ104038" },
            { name: "CÔNG TY CỔ PHẦN PIZZA 4PS", address: "Số 5 Phạm Ngọc Thạch, Phường Xuân Hòa", email: "acbdd62@gmail.com", phone: "042884364", code_number: "SQ104261" },
            { name: "CÔNG TY CỔ PHẦN PHÚC LONG HERITAGE", address: "281 - 283 Nguyễn Trãi, P. Nguyễn Cư Trinh, Q. 1", email: "acbdd63@gmail.com", phone: "020202641", code_number: "CQ107039" },
            { name: "CHI NHÁNH THÀNH PHỐ HỒ CHÍ MINH - CÔNG TY CỔ PHẦN ẨM THỰC MẶT TRỜI VÀNG", address: "6B Công Trường Quốc Tế, P. 6, Q. 3", email: "acbdd64@gmail.com", phone: "061874329", code_number: "CQ106807" },
            { name: "CÔNG TY TNHH SEVEN BRIDGES", address: "20 Trần Cao Vân, P. Đa Kao, Q. 1", email: "acbdd65@gmail.com", phone: "095550064", code_number: "CQ104675" },
            { name: "CÔNG TY CỔ PHẦN THƯƠNG MẠI SIM BA", address: "Số 764 Sư Vạn Hạnh, P. 12, Q. 10", email: "acbdd66@gmail.com", phone: "044577029", code_number: "CQ104089" },
            { name: "CÔNG TY TNHH DL SWEETS", address: "Số 457 Sư Vạn Hạnh, P. 12, Q.10", email: "acbdd67@gmail.com", phone: "038770921", code_number: "CQ103140" },
            { name: "CÔNG TY TNHH SEO NAM", address: "Số 102-104, Mạc Thị Bưởi, P. Bến Nghé, Q. 1", email: "acbdd68@gmail.com", phone: "076820233", code_number: "CQ106649" },
            { name: "CÔNG TY TNHH MỘT THÀNH VIÊN SANNADLE", address: "Số 172-173 Bến Vân Đồn, P. 6, Q. 4", email: "acbdd69@gmail.com", phone: "041647601", code_number: "CQ104140" },
            { name: "CÔNG TY TNHH DAILY FOOD VIỆT NAM", address: "Số 78 Nguyễn Đình Chiểu, P.Đa Kao, Q.1", email: "acbdd70@gmail.com", phone: "059000736", code_number: "CQ108613" },
            { name: "CÔNG TY TNHH THỰC PHẨM CAO CẤP", address: "35-37 Ngô Đức Kế, P. Bến Nghé, Q. 1", email: "acbdd71@gmail.com", phone: "065924538", code_number: "SQ103500" },
            { name: "CHI NHÁNH CÔNG TY TNHH VẬN TẢI VIỆT NHẬT TẠI ĐÀ NẴNG", address: "32 Hoa Mai, P. 2, Q. Phú Nhuận", email: "acbdd72@gmail.com", phone: "052876012", code_number: "CQ104435" },
            { name: "CÔNG TY CỔ PHẦN THƯƠNG MẠI & DV XUÂN TRƯỜNG", address: "357 Lê Văn Sỹ, P. 01, Q. Tân Bình", email: "acbdd73@gmail.com", phone: "039236508", code_number: "CQ108658" },
            { name: "CÔNG TY TNHH THƯƠNG MẠI NGỌC MAI", address: "Số 40/13 Nguyễn Văn Đậu, P. 6, Q. Bình Thạnh", email: "acbdd74@gmail.com", phone: "046236179", code_number: "CQ108606" },
            { name: "CÔNG TY TNHH THƯƠNG MẠI DỊCH VỤ HOÀNG MAI FOODS", address: "54 Thuận Kiều, P. 4, Q. 11", email: "acbdd75@gmail.com", phone: "032480865", code_number: "CQ109193" },
            { name: "CÔNG TY CỔ PHẦN VÂN VŨ", address: "Tầng 3, Số 411 Trần Hưng Đạo B, P. 14, Q. 5", email: "acbdd76@gmail.com", phone: "072642218", code_number: "CQ108610" },
            { name: "CÔNG TY TNHH THƯƠNG MẠI THỰC PHẨM VIỆT ÂU", address: "Số 9A Lam Sơn, P. 2, Q. Tân Bình", email: "acbdd77@gmail.com", phone: "054884445", code_number: "CQ107959" },
            { name: "CÔNG TY CỔ PHẦN FGC", address: "số 383 Điện Biên Phủ, P. 25, Q. Bình Thạnh", email: "acbdd78@gmail.com", phone: "067199060", code_number: "CQ103795" },
            { name: "CÔNG TY TNHH FONTERRA BRANDS (VIỆT NAM)", address: "185 - 187 Kênh Tân Hoá, P. Hoà Thạnh, Q. Tân Phú", email: "acbdd79@gmail.com", phone: "063829959", code_number: "CQ104013" },
            { name: "CÔNG TY CỔ PHẦN PHÊ LA", address: "48Bis Xuân Thủy, P. Thảo Điền, Q. 2", email: "acbdd80@gmail.com", phone: "019868165", code_number: "CQ107719" },
            { name: "CÔNG TY TNHH LÂM HÒA THỦY", address: "20 Trần Cao Vân, P. Đa Kao, Q. 1", email: "acbdd81@gmail.com", phone: "036687623", code_number: "CQ104614" },
            { name: "CHI NHÁNH CÔNG TY CỔ PHẦN ĐẠI TÂN VIỆT TẠI ĐÀ NẴNG", address: "Số 764 Sư Vạn Hạnh, P. 12, Q. 10", email: "acbdd82@gmail.com", phone: "072428619", code_number: "CQ108431" },
            { name: "CÔNG TY TNHH MỘT THÀNH VIÊN VẬN TẢI TRẦN GIA PHÁT", address: "Số 457 Sư Vạn Hạnh, P. 12, Q.10", email: "acbdd83@gmail.com", phone: "071083078", code_number: "CQ106816" },
            { name: "CÔNG TY TNHH GIẢI PHÁP THƯƠNG MẠI SÀI GÒN", address: "Số 102-104, Mạc Thị Bưởi, P. Bến Nghé, Q. 1", email: "acbdd84@gmail.com", phone: "028232513", code_number: "CQ105541" },
            { name: "CÔNG TY TNHH YCH-PROTRADE", address: "Số 172-173 Bến Vân Đồn, P. 6, Q. 4", email: "acbdd85@gmail.com", phone: "061305815", code_number: "CQ106107" },
            { name: "CÔNG TY TNHH THƯƠNG MẠI DỊCH VỤ VẬN TẢI TẤN THÀNH", address: "Số 78 Nguyễn Đình Chiểu, P.Đa Kao, Q.1", email: "acbdd86@gmail.com", phone: "068656316", code_number: "SQ103613" },
            { name: "CÔNG TY TNHH ĐƯỜNG TƠ LỤA VN", address: "357 Lê Văn Sỹ, P. 01, Q. Tân Bình", email: "acbdd87@gmail.com", phone: "080938287", code_number: "CQ105622" },
            { name: "CÔNG TY TNHH THƯƠNG MẠI THỰC PHẨM CÂU LẠC BỘ", address: "Số 40/13 Nguyễn Văn Đậu, P. 6, Q. Bình Thạnh", email: "acbdd88@gmail.com", phone: "054119754", code_number: "CQ108875" },
            { name: "CÔNG TY TNHH PULMUONE VIỆT NAM", address: "54 Thuận Kiều, P. 4, Q. 11", email: "acbdd89@gmail.com", phone: "073227606", code_number: "CQ108800" }
        ];

        const routes = [
            "Hồ Chí Minh -> Hà Nội",
            "Hồ Chí Minh -> Đà Nẵng",
            "Hồ Chí Minh -> Hải Phòng",
            "Hồ Chí Minh -> Cần Thơ",
            "Hồ Chí Minh -> Đà Lạt",
            "Hồ Chí Minh -> Vũng Tàu",
            "Đà Nẵng -> Quy Nhơn",
            "Hải Phòng -> Quảng Ninh"
        ];

        const routeAbbreviations = {
            "HCM": "Hồ Chí Minh",
            "HN": "Hà Nội",
            "DN": "Đà Nẵng",
            "HP": "Hải Phòng",
            "CT": "Cần Thơ",
            "DL": "Đà Lạt",
            "VT": "Vũng Tàu",
            "QN": "Quy Nhơn",
            "QNI": "Quảng Ninh"
            // Có thể thêm nhiều hơn nếu cần
        };

        const vehicles = [
            { number: "51C-12345", driver: "Nguyễn Văn A", phone: "0909123456" },
            { number: "51D-67890", driver: "Trần Thị B", phone: "0912678901" },
            { number: "51E-54321", driver: "Lê Văn C", phone: "0921543210" },
            { number: "51F-09876", driver: "Phạm Thị D", phone: "0934098765" },
            { number: "51G-11223", driver: "Hoàng Văn E", phone: "0945112233" },
            { number: "51H-44556", driver: "Vũ Thị F", phone: "0956445566" },
            { number: "51K-77889", driver: "Đặng Văn G", phone: "0966778899" },
            { number: "51L-99000", driver: "Bùi Thị H", phone: "0977990001" }
        ];

        // Khởi tạo dữ liệu từ localStorage nếu có
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let customerStores = JSON.parse(localStorage.getItem('customerStores')) || {};

        // Lưu dữ liệu mẫu vào localStorage nếu chưa có
        if (!localStorage.getItem('customers')) {
            localStorage.setItem('customers', JSON.stringify(customers));
        }
        if (!localStorage.getItem('routes')) {
            localStorage.setItem('routes', JSON.stringify(routes));
        }
        if (!localStorage.getItem('vehicles')) {
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
        }

        // Debug: Log existing orders to check for data issues
        console.log('Loaded orders from localStorage:', orders);
        console.log('Loaded customer stores:', customerStores);

        // Cấu hình phân trang
        let currentPage = 1;
        const ordersPerPage = 10;

        // DOM Elements
        const customerInput = document.getElementById('customerInput');
        const suggestions = document.getElementById('customerSuggestions');
        const storeInput = document.getElementById('storeInput');
        const storeSuggestions = document.getElementById('storeSuggestions');
        const routeInput = document.getElementById('routeInput');
        const routeSuggestions = document.getElementById('routeSuggestions');
        const routeDisplay = document.getElementById('routeDisplay');
        const routeText = document.getElementById('routeText');
        const form = document.getElementById('inputForm');
        const notification = document.getElementById('notification');
        const ordersTableBody = document.querySelector('#ordersTable tbody');
        const paginationElement = document.getElementById('pagination');
        const emptyState = document.getElementById('emptyState');
        const totalOrdersElement = document.getElementById('totalOrders');
        const totalWeightElement = document.getElementById('totalWeight');
        const totalVolumeElement = document.getElementById('totalVolume');
        const totalVehiclesElement = document.getElementById('totalVehicles');
        const routeSelector = document.getElementById('routeSelector');
        const exportExcelBtn = document.getElementById('exportExcel');

        // Cập nhật danh sách đơn hàng khi tải trang
        updateOrdersTable();
        setupPagination();
        updateRouteSelector();

        // Button xóa dữ liệu
        document.getElementById('clearData').addEventListener('click', () => {
            if (confirm('Bạn có chắc chắn muốn xóa tất cả dữ liệu? Hành động này không thể hoàn tác!')) {
                localStorage.removeItem('orders');
                orders = [];
                updateOrdersTable();
                setupPagination();
                updateRouteSelector();
                showNotification('Đã xóa tất cả dữ liệu!');
            }
        });

        // Autocomplete cho khách hàng
        customerInput.addEventListener('keyup', () => {
            const query = customerInput.value.toLowerCase();
            suggestions.innerHTML = '';
            suggestions.classList.add('hidden');

            if (query) {
                const matches = customers.filter(c =>
                    c.name.toLowerCase().includes(query) ||
                    c.address.toLowerCase().includes(query)
                );

                if (matches.length) {
                    suggestions.classList.remove('hidden');
                    matches.forEach(match => {
                        const div = document.createElement('div');
                        div.classList.add('autocomplete-suggestion');
                        div.innerHTML = `<strong>${match.name}</strong><br><small>${match.address}</small>`;
                        div.addEventListener('click', () => {
                            customerInput.value = match.name;
                            suggestions.classList.add('hidden');
                            clearError(customerInput);
                            
                            // Tự động điền thông tin cửa hàng nếu có
                            if (customerStores[match.name] && customerStores[match.name].length > 0) {
                                storeInput.value = customerStores[match.name][0];
                            }
                        });
                        suggestions.appendChild(div);
                    });
                }
            }
        });

        // Autocomplete cho Store
        storeInput.addEventListener('keyup', () => {
            const query = storeInput.value.toLowerCase();
            const selectedCustomer = customerInput.value.trim();
            storeSuggestions.innerHTML = '';
            storeSuggestions.classList.add('hidden');

            if (query && selectedCustomer) {
                // Lấy danh sách stores của customer hiện tại
                const customerStoreList = customerStores[selectedCustomer] || [];
                const matches = customerStoreList.filter(store =>
                    store.toLowerCase().includes(query)
                );

                if (matches.length) {
                    storeSuggestions.classList.remove('hidden');
                    // Sắp xếp từ mới nhất đến cũ nhất (theo thứ tự thêm vào)
                    matches.reverse().forEach(match => {
                        const div = document.createElement('div');
                        div.classList.add('autocomplete-suggestion');
                        div.textContent = match;
                        div.addEventListener('click', () => {
                            storeInput.value = match;
                            storeSuggestions.classList.add('hidden');
                        });
                        storeSuggestions.appendChild(div);
                    });
                }
            }
        });

        // Autocomplete cho số xe - tìm kiếm cả số xe và tên tài xế
        const vehicleInput = document.getElementById('vehicleInput');
        const vehicleSuggestions = document.getElementById('vehicleSuggestions');

        vehicleInput.addEventListener('keyup', () => {
            const query = vehicleInput.value.toUpperCase();
            vehicleSuggestions.innerHTML = '';
            vehicleSuggestions.classList.add('hidden');

            if (query) {
                const matches = vehicles.filter(v =>
                    v.number.toUpperCase().includes(query) ||
                    v.driver.toUpperCase().includes(query)
                );

                if (matches.length) {
                    vehicleSuggestions.classList.remove('hidden');
                    matches.forEach(match => {
                        const div = document.createElement('div');
                        div.classList.add('autocomplete-suggestion');
                        div.innerHTML = `<strong>${match.number}</strong> - ${match.driver}`;
                        div.addEventListener('click', () => {
                            vehicleInput.value = match.number;
                            vehicleSuggestions.classList.add('hidden');
                            clearError(vehicleInput);
                        });
                        vehicleSuggestions.appendChild(div);
                    });
                }
            }
        });

        // Autocomplete cho tuyến đường (hỗ trợ viết tắt và space làm phân cách)
        routeInput.addEventListener('keyup', () => {
            const query = routeInput.value.trim().toUpperCase();
            routeSuggestions.innerHTML = '';
            routeSuggestions.classList.add('hidden');

            if (query) {
                // Gợi ý các viết tắt phổ biến
                const commonAbbreviations = [
                    { abbr: "HCM HN", full: "Hồ Chí Minh -> Hà Nội" },
                    { abbr: "HCM DN", full: "Hồ Chí Minh -> Đà Nẵng" },
                    { abbr: "HCM HP", full: "Hồ Chí Minh -> Hải Phòng" },
                    { abbr: "HCM CT", full: "Hồ Chí Minh -> Cần Thơ" },
                    { abbr: "HCM DL", full: "Hồ Chí Minh -> Đà Lạt" },
                    { abbr: "HCM VT", full: "Hồ Chí Minh -> Vũng Tàu" },
                    { abbr: "DN QN", full: "Đà Nẵng -> Quy Nhơn" },
                    { abbr: "HP QNI", full: "Hải Phòng -> Quảng Ninh" },
                    { abbr: "HP QUANG NINH", full: "Hải Phòng -> Quảng Ninh" },
                    { abbr: "HAI PHONG QUANG NINH", full: "Hải Phòng -> Quảng Ninh" },
                    { abbr: "DA NANG QUY NHON", full: "Đà Nẵng -> Quy Nhơn" }
                ];

                // Tìm gợi ý từ viết tắt
                const abbrMatches = commonAbbreviations.filter(item =>
                    item.abbr.includes(query) || item.full.toUpperCase().includes(query)
                );

                // Tìm gợi ý từ routes thông thường
                const routeMatches = routes.filter(route =>
                    route.toUpperCase().includes(query)
                );

                // Kết hợp và hiển thị gợi ý
                const allMatches = [...new Set([...abbrMatches.map(item => item.full), ...routeMatches])];

                if (allMatches.length) {
                    routeSuggestions.classList.remove('hidden');
                    allMatches.forEach(match => {
                        const div = document.createElement('div');
                        div.classList.add('autocomplete-suggestion');
                        div.textContent = match;

                        // Hiển thị viết tắt nếu có
                        const abbr = commonAbbreviations.find(item => item.full === match);
                        if (abbr) {
                            div.innerHTML = `${match} <small style="opacity: 0.7;">(${abbr.abbr})</small>`;
                        }

                        div.addEventListener('click', () => {
                            // Truyền trực tiếp route đầy đủ để hiển thị
                            routeText.textContent = match;
                            routeDisplay.classList.remove('hidden');
                            routeInput.value = match.replace(' -> ', ' ');
                            routeSuggestions.classList.add('hidden');
                            clearError(routeInput);
                        });
                        routeSuggestions.appendChild(div);
                    });
                }
            }

            updateRouteDisplay();
        });

        // Hiển thị tuyến đường
        function updateRouteDisplay(route = null) {
            const inputValue = routeInput.value.trim();
            if (inputValue) {
                let parts = inputValue.split(' ');
                if (parts.length >= 2) {
                    // Xử lý các trường hợp viết tắt phổ biến
                    const input = inputValue.toUpperCase();

                    // Mapping các viết tắt phổ biến
                    const routeMappings = {
                        "HCM HN": "Hồ Chí Minh -> Hà Nội",
                        "HCM DN": "Hồ Chí Minh -> Đà Nẵng",
                        "HCM HP": "Hồ Chí Minh -> Hải Phòng",
                        "HCM CT": "Hồ Chí Minh -> Cần Thơ",
                        "HCM DL": "Hồ Chí Minh -> Đà Lạt",
                        "HCM VT": "Hồ Chí Minh -> Vũng Tàu",
                        "DN QN": "Đà Nẵng -> Quy Nhơn",
                        "HP QNI": "Hải Phòng -> Quảng Ninh",
                        "HP QUANG NINH": "Hải Phòng -> Quảng Ninh",
                        "HAI PHONG QUANG NINH": "Hải Phòng -> Quảng Ninh",
                        "DA NANG QUY NHON": "Đà Nẵng -> Quy Nhơn"
                    };

                    // Kiểm tra mapping trực tiếp trước
                    if (routeMappings[input]) {
                        const fullRoute = routeMappings[input];
                        routeText.textContent = fullRoute;
                        routeDisplay.classList.remove('hidden');
                        return fullRoute;
                    }

                    // Xử lý theo cách cũ nếu không có mapping
                    const startAbbr = parts[0].toUpperCase();
                    const endAbbr = parts.slice(1).join(' ').toUpperCase();
                    const startFull = routeAbbreviations[startAbbr] || startAbbr;
                    const endFull = routeAbbreviations[endAbbr] || endAbbr;
                    const fullRoute = `${startFull} -> ${endFull}`;
                    routeText.textContent = fullRoute;
                    routeDisplay.classList.remove('hidden');
                    return fullRoute;
                } else if (route) {
                    routeText.textContent = route;
                    routeDisplay.classList.remove('hidden');
                    return route;
                }
            }
            routeDisplay.classList.add('hidden');
            return null;
        }

        // Tick khách hàng mới
        document.getElementById('newCustomer').addEventListener('change', (e) => {
            document.getElementById('newCustomerForm').classList.toggle('hidden', !e.target.checked);
        });

        // Tick lấy/giao tận nơi
        document.getElementById('customPickup').addEventListener('change', (e) => {
            document.getElementById('pickupAddress').classList.toggle('hidden', !e.target.checked);
        });

        document.getElementById('customDelivery').addEventListener('change', (e) => {
            document.getElementById('deliveryAddress').classList.toggle('hidden', !e.target.checked);
        });

        // Cập nhật route selector (thêm All)
        function updateRouteSelector() {
            // Lấy tất cả các tuyến đường duy nhất từ orders
            const uniqueRoutes = [...new Set(orders.map(order => order.route))];

            routeSelector.innerHTML = '<option value="">-- Chọn tuyến đường --</option><option value="All">All</option>';

            uniqueRoutes.forEach(route => {
                const option = document.createElement('option');
                option.value = route;
                option.textContent = route;
                routeSelector.appendChild(option);
            });

            // Nếu có tuyến đường, chọn tuyến đầu tiên
            if (uniqueRoutes.length > 0) {
                routeSelector.value = uniqueRoutes[0];
                updateCartHeader(uniqueRoutes[0]);
            }
        }

        // Xử lý thay đổi tuyến đường trong selector
        routeSelector.addEventListener('change', () => {
            updateCartHeader(routeSelector.value);
        });

        // Cập nhật cart header
        function updateCartHeader(route) {
            let routeOrders;
            if (route === 'All' || !route) {
                routeOrders = orders;
            } else {
                routeOrders = orders.filter(order => order.route === route);
            }

            if (routeOrders.length > 0) {
                const totalWeight = routeOrders.reduce((sum, order) => sum + order.totalWeight, 0);
                const totalVolume = routeOrders.reduce((sum, order) => sum + order.totalVolume, 0);
                // Giả sử mỗi xe chở được 5000kg và 30m³
                const vehiclesByWeight = Math.ceil(totalWeight / 5000);
                const vehiclesByVolume = Math.ceil(totalVolume / 30);
                const vehiclesNeeded = Math.max(vehiclesByWeight, vehiclesByVolume);

                totalOrdersElement.textContent = routeOrders.length;
                totalWeightElement.textContent = totalWeight.toLocaleString();
                totalVolumeElement.textContent = totalVolume.toLocaleString();
                totalVehiclesElement.textContent = vehiclesNeeded;
            } else {
                totalOrdersElement.textContent = '0';
                totalWeightElement.textContent = '0';
                totalVolumeElement.textContent = '0';
                totalVehiclesElement.textContent = '0';
            }
        }

        // Cập nhật bảng đơn hàng
        function updateOrdersTable() {
            ordersTableBody.innerHTML = '';

            if (orders.length === 0) {
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            // Tính chỉ số bắt đầu và kết thúc cho trang hiện tại
            const startIndex = (currentPage - 1) * ordersPerPage;
            const endIndex = Math.min(startIndex + ordersPerPage, orders.length);

            for (let i = startIndex; i < endIndex; i++) {
                const order = orders[i];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(order.date).toLocaleDateString('vi-VN')}</td>
                    <td>${order.customer}</td>
                    <td>${order.store || ''}</td>
                    <td>${order.route}</td>
                    <td>${order.vehicleNumber || ''}</td>
                    <td>${order.totalPackages.toLocaleString()}</td>
                    <td>${order.totalWeight.toLocaleString()}</td>
                    <td>${order.totalVolume.toLocaleString()}</td>
                    
                    <td>
                        <button onclick="window.open('transport_note.html?id=${order.id}', '_blank')" class="btn btn-info">Xem phiếu</button>
                        <button class="btn" onclick="viewOrder(${i})"><i class="fas fa-eye"></i></button>
                        <button class="btn btn-reset" onclick="deleteOrder(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                ordersTableBody.appendChild(row);
            }
        }

        // Thiết lập phân trang
        function setupPagination() {
            paginationElement.innerHTML = '';

            if (orders.length === 0) {
                return;
            }

            const pageCount = Math.ceil(orders.length / ordersPerPage);

            // Nút Previous
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.innerHTML = '&laquo;';
                prevButton.addEventListener('click', () => {
                    currentPage--;
                    updateOrdersTable();
                    setupPagination();
                });
                paginationElement.appendChild(prevButton);
            }

            // Các nút trang
            for (let i = 1; i <= pageCount; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                if (i === currentPage) {
                    pageButton.classList.add('active');
                }
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    updateOrdersTable();
                    setupPagination();
                });
                paginationElement.appendChild(pageButton);
            }

            // Nút Next
            if (currentPage < pageCount) {
                const nextButton = document.createElement('button');
                nextButton.innerHTML = '&raquo;';
                nextButton.addEventListener('click', () => {
                    currentPage++;
                    updateOrdersTable();
                    setupPagination();
                });
                paginationElement.appendChild(nextButton);
            }
        }

        // Hiển thị thông báo
        function showNotification(message, isError = false) {
            notification.innerHTML = `<i class="fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i><span>${message}</span>`;

            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Hiển thị lỗi
        function showError(input, message) {
            input.classList.add('error');
            const errorElement = document.getElementById(input.id + 'Error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
        }

        // Xóa lỗi
        function clearError(input) {
            input.classList.remove('error');
            const errorElement = document.getElementById(input.id + 'Error');
            if (errorElement) {
                errorElement.classList.remove('show');
            }
        }

        // Validate form
        function validateForm() {
            let isValid = true;

            // Validate khách hàng
            const isNewCustomer = document.getElementById('newCustomer').checked;
            if (isNewCustomer) {
                const newNameInput = document.getElementById('newName');
                if (!newNameInput.value.trim()) {
                    showError(newNameInput, 'Vui lòng nhập tên khách hàng mới');
                    isValid = false;
                }
            } else {
                if (!customerInput.value.trim()) {
                    showError(customerInput, 'Vui lòng nhập tên khách hàng');
                    isValid = false;
                }
            }

            // Validate tuyến đường
            if (!routeInput.value.trim()) {
                showError(routeInput, 'Vui lòng nhập tuyến đường');
                isValid = false;
            }

            // Validate số xe
            const vehicleInput = document.getElementById('vehicleInput');
            if (!vehicleInput.value.trim()) {
                showError(vehicleInput, 'Vui lòng nhập số xe');
                isValid = false;
            }

            return isValid;
        }

        // Xử lý submit form
        form.addEventListener('submit', (e) => {
            e.preventDefault();

            if (!validateForm()) {
                // Focus vào trường đầu tiên bị lỗi
                const firstError = form.querySelector('.error');
                if (firstError) {
                    firstError.focus();
                }
                return;
            }

            const isNewCustomer = document.getElementById('newCustomer').checked;
            let customer;
            if (isNewCustomer) {
                customer = document.getElementById('newName').value;
                const newAddress = document.getElementById('newAddress').value;
                const newPhone = document.getElementById('newPhone').value;
                // Thêm khách hàng mới vào danh sách (nếu cần)
                customers.push({ name: customer, address: newAddress, phone: newPhone });
                localStorage.setItem('customers', JSON.stringify(customers));
            } else {
                customer = customerInput.value;
            }

            const route = routeDisplay.classList.contains('hidden') ?
                (updateRouteDisplay() || routeInput.value) :
                routeText.textContent;
            const vehicleNumber = document.getElementById('vehicleInput').value;
            const store = storeInput.value.trim(); // Lấy thông tin store

            console.log('Route being saved:', route); // Debug log

            // Lấy thông tin lấy hàng/giao hàng tận nơi nếu có
            const pickupAddr = document.getElementById('customPickup').checked ? document.getElementById('pickupAddr').value : '';
            const pickupContact = document.getElementById('customPickup').checked ? document.getElementById('pickupContact').value : '';
            const pickupPhone = document.getElementById('customPickup').checked ? document.getElementById('pickupPhone').value : '';

            const deliveryAddr = document.getElementById('customDelivery').checked ? document.getElementById('deliveryAddr').value : '';
            const deliveryContact = document.getElementById('customDelivery').checked ? document.getElementById('deliveryContact').value : '';
            const deliveryPhone = document.getElementById('customDelivery').checked ? document.getElementById('deliveryPhone').value : '';

            // Tính tổng kiện, kg và khối lượng theo từng loại hàng
            let totalPackages = 0;
            let totalWeight = 0;
            let totalVolume = 0;

            // Lấy chi tiết hàng đông
            const frozenPkg = parseInt(document.querySelector('.pkg.frozen').value) || 0;
            const frozenWeight = parseFloat(document.querySelector('.kg.frozen').value) || 0;
            const frozenVolume = parseFloat(document.querySelector('.vol.frozen').value) || 0;
            const frozenNote = document.querySelector('input.frozen[type="text"]').value || '';

            // Lấy chi tiết hàng mát
            const coolPkg = parseInt(document.querySelector('.pkg.cool').value) || 0;
            const coolWeight = parseFloat(document.querySelector('.kg.cool').value) || 0;
            const coolVolume = parseFloat(document.querySelector('.vol.cool').value) || 0;
            const coolNote = document.querySelector('input.cool[type="text"]').value || '';

            // Lấy chi tiết hàng khô
            const dryPkg = parseInt(document.querySelector('.pkg.dry').value) || 0;
            const dryWeight = parseFloat(document.querySelector('.kg.dry').value) || 0;
            const dryVolume = parseFloat(document.querySelector('.vol.dry').value) || 0;
            const dryNote = document.querySelector('input.dry[type="text"]').value || '';

            // Tính tổng
            totalPackages = frozenPkg + coolPkg + dryPkg;
            totalWeight = frozenWeight + coolWeight + dryWeight;
            totalVolume = frozenVolume + coolVolume + dryVolume;

            // Tạo đơn hàng mới
            const newOrder = {
                id: Date.now(),
                customer,
                store, // Thêm trường store
                route,
                vehicleNumber,
                totalPackages,
                totalWeight,
                totalVolume,
                // Chi tiết hàng đông
                frozen: {
                    packages: frozenPkg,
                    weight: frozenWeight,
                    volume: frozenVolume,
                    note: frozenNote
                },
                // Chi tiết hàng mát
                cool: {
                    packages: coolPkg,
                    weight: coolWeight,
                    volume: coolVolume,
                    note: coolNote
                },
                // Chi tiết hàng khô
                dry: {
                    packages: dryPkg,
                    weight: dryWeight,
                    volume: dryVolume,
                    note: dryNote
                },
                pickupAddr,
                pickupContact,
                pickupPhone,
                deliveryAddr,
                deliveryContact,
                deliveryPhone,
                date: new Date().toISOString()
            };

            // Thêm vào mảng orders
            orders.unshift(newOrder);

            // Lưu store khi tạo phiếu thành công
            if (customer && store) {
                if (!customerStores[customer]) {
                    customerStores[customer] = [];
                }

                // Kiểm tra xem store đã tồn tại chưa
                if (!customerStores[customer].includes(store)) {
                    customerStores[customer].push(store);
                    localStorage.setItem('customerStores', JSON.stringify(customerStores));
                }
            }

            // Lưu vào localStorage
            localStorage.setItem('orders', JSON.stringify(orders));

            // Cập nhật bảng
            currentPage = 1;
            updateOrdersTable();
            setupPagination();
            updateRouteSelector();

            // Hiển thị thông báo
            showNotification('Phiếu hàng đã được tạo thành công!');

            // Reset form
            //chỗ lấy tận nơi ch
            form.reset();
            document.querySelectorAll('.hidden').forEach(el => {
                if (!el.id.includes('Address') && !el.id.includes('CustomerForm')) {
                    el.classList.add('hidden');
                }
            });

            // Cập nhật cart header nếu đang hiển thị
            if (routeSelector.value === route || routeSelector.value === 'All') {
                updateCartHeader(routeSelector.value);
            }
        });

        // Xử lý nút reset
        form.addEventListener('reset', () => {
            // Ẩn tất cả các phần ẩn
            document.querySelectorAll('.hidden').forEach(el => {
                if (!el.id.includes('Address') && !el.id.includes('CustomerForm')) {
                    el.classList.add('hidden');
                }
            });
            

            // Bỏ chọn các checkbox
            document.getElementById('newCustomer').checked = false;
            document.getElementById('customPickup').checked = false;
            document.getElementById('customDelivery').checked = false;

            // Xóa các lỗi
            clearError(customerInput);
            clearError(routeInput);
            clearError(document.getElementById('vehicleInput'));
            clearError(document.getElementById('newName'));
        });

        // Xem chi tiết đơn hàng
        function viewOrder(index) {
            const order = orders[index];
            let details = `Chi tiết đơn hàng:\nKhách hàng: ${order.customer}`;

            if (order.store) {
                details += `\nCửa hàng: ${order.store}`;
            }

            details += `\nTuyến đường: ${order.route}\nSố xe: ${order.vehicleNumber || 'Chưa có'}`;

            // Hiển thị chi tiết từng loại hàng
            if (order.frozen && (order.frozen.packages > 0 || order.frozen.weight > 0 || order.frozen.volume > 0)) {
                details += `\n\nHàng Đông:\n- Số kiện: ${order.frozen.packages}\n- Trọng lượng: ${order.frozen.weight} kg\n- Khối lượng: ${order.frozen.volume} m³`;
                if (order.frozen.note) details += `\n- Ghi chú: ${order.frozen.note}`;
            }

            if (order.cool && (order.cool.packages > 0 || order.cool.weight > 0 || order.cool.volume > 0)) {
                details += `\n\nHàng Mát:\n- Số kiện: ${order.cool.packages}\n- Trọng lượng: ${order.cool.weight} kg\n- Khối lượng: ${order.cool.volume} m³`;
                if (order.cool.note) details += `\n- Ghi chú: ${order.cool.note}`;
            }

            if (order.dry && (order.dry.packages > 0 || order.dry.weight > 0 || order.dry.volume > 0)) {
                details += `\n\nHàng Khô:\n- Số kiện: ${order.dry.packages}\n- Trọng lượng: ${order.dry.weight} kg\n- Khối lượng: ${order.dry.volume} m³`;
                if (order.dry.note) details += `\n- Ghi chú: ${order.dry.note}`;
            }

            details += `\n\nTổng cộng:\n- Số kiện: ${order.totalPackages}\n- Trọng lượng: ${order.totalWeight} kg\n- Khối lượng: ${order.totalVolume} m³`;

            if (order.pickupAddr) {
                details += `\n\nLấy hàng tận nơi:\nĐịa chỉ: ${order.pickupAddr}\nNgười liên hệ: ${order.pickupContact}\nSĐT: ${order.pickupPhone}`;
            }

            if (order.deliveryAddr) {
                details += `\n\nGiao hàng tận nơi:\nĐịa chỉ: ${order.deliveryAddr}\nNgười liên hệ: ${order.deliveryContact}\nSĐT: ${order.deliveryPhone}`;
            }

            alert(details);
        }

        // Xóa đơn hàng
        function deleteOrder(index) {
            if (confirm('Bạn có chắc chắn muốn xóa đơn hàng này?')) {
                orders.splice(index, 1);
                localStorage.setItem('orders', JSON.stringify(orders));
                updateOrdersTable();
                setupPagination();
                updateRouteSelector();
                showNotification('Đơn hàng đã được xóa!');

                // Cập nhật cart header nếu đang hiển thị
                updateCartHeader(routeSelector.value);
            }
        }

        // Export ra Excel với UTF-8 BOM để hiển thị font chữ Tiếng Việt đúng
        exportExcelBtn.addEventListener('click', async () => {
            if (orders.length === 0) {
                showNotification('Không có dữ liệu để export!', true);
                return;
            }

            try {
                // Tạo workbook và worksheet
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('Đơn hàng');

                // Định nghĩa headers với 2 dòng
                // Dòng 1: Header chính (có merge)
                const headerRow1 = worksheet.addRow([
                    'STT', 'Khách Hàng', 'Cửa hàng', 'Tuyến Đường', 'Số Xe',
                    'Hàng Đông', '', '', // 3 cột cho Hàng Đông
                    'Hàng Mát', '', '', // 3 cột cho Hàng Mát
                    'Hàng Khô', '', '', // 3 cột cho Hàng Khô
                    'Tổng Số Kiện', 'Tổng Trọng Lượng (kg)', 'Tổng Khối Lượng (m³)',
                    'Địa chỉ lấy hàng', 'Liên hệ lấy hàng', 'SĐT lấy hàng',
                    'Địa chỉ giao hàng', 'Liên hệ giao hàng', 'SĐT giao hàng',
                    'Ngày Tạo'
                ]);

                // Dòng 2: Header con
                worksheet.addRow([
                    '', '', '', '', '', // 5 cột đầu không có header con
                    'Số kiện', 'Trọng lượng (kg)', 'Khối lượng (m³)', // Header con cho Hàng Đông
                    'Số kiện', 'Trọng lượng (kg)', 'Khối lượng (m³)', // Header con cho Hàng Mát
                    'Số kiện', 'Trọng lượng (kg)', 'Khối lượng (m³)', // Header con cho Hàng Khô
                    '', '', '', // Các cột tổng
                    '', '', '',
                    '', '', '',
                    ''
                ]);

                // Merge các ô cho header chính
                worksheet.mergeCells('F1:H1'); // Hàng Đông (merge 3 cột F,G,H)
                worksheet.mergeCells('I1:K1'); // Hàng Mát (merge 3 cột I,J,K)
                worksheet.mergeCells('L1:N1'); // Hàng Khô (merge 3 cột L,M,N)

                // Style cho header
                headerRow1.eachCell((cell) => {
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'FF1E3A8A' }
                    };
                    cell.font = {
                        bold: true,
                        color: { argb: 'FFFFFFFF' }
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' }
                    };
                });

                // Style cho header con
                worksheet.getRow(2).eachCell((cell) => {
                    cell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'FF3B82F6' }
                    };
                    cell.font = {
                        bold: true,
                        color: { argb: 'FFFFFFFF' }
                    };
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' }
                    };
                });

                // Căn giữa các header chính
                ['F1', 'I1', 'L1'].forEach(cell => {
                    worksheet.getCell(cell).alignment = {
                        vertical: 'middle',
                        horizontal: 'center'
                    };
                });

                // Đổ dữ liệu
                orders.forEach((order, index) => {
                    const row = worksheet.addRow([
                        index + 1,
                        order.customer,
                        order.store || '',
                        order.route,
                        order.vehicleNumber || '',
                        // Hàng Đông
                        (order.frozen && order.frozen.packages) || 0,
                        (order.frozen && order.frozen.weight) || 0,
                        (order.frozen && order.frozen.volume) || 0,
                        // Hàng Mát
                        (order.cool && order.cool.packages) || 0,
                        (order.cool && order.cool.weight) || 0,
                        (order.cool && order.cool.volume) || 0,
                        // Hàng Khô
                        (order.dry && order.dry.packages) || 0,
                        (order.dry && order.dry.weight) || 0,
                        (order.dry && order.dry.volume) || 0,
                        // Tổng
                        order.totalPackages,
                        order.totalWeight,
                        order.totalVolume,
                        // Địa chỉ
                        order.pickupAddr || '',
                        order.pickupContact || '',
                        order.pickupPhone || '',
                        order.deliveryAddr || '',
                        order.deliveryContact || '',
                        order.deliveryPhone || '',
                        new Date(order.date).toLocaleDateString('vi-VN')
                    ]);
                });

                // Tự động điều chỉnh độ rộng cột
                worksheet.columns.forEach(column => {
                    let maxLength = 0;
                    column.eachCell({ includeEmpty: true }, cell => {
                        const columnLength = cell.value ? cell.value.toString().length : 10;
                        if (columnLength > maxLength) {
                            maxLength = columnLength;
                        }
                    });
                    column.width = maxLength < 10 ? 10 : maxLength + 2;
                });

                // Tạo file và download
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], {
                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'don_hang_chi_tiet.xlsx';
                a.click();
                URL.revokeObjectURL(url);

                showNotification('Đã export Excel chi tiết thành công!');
            } catch (error) {
                console.error('Lỗi khi export Excel:', error);
                showNotification('Có lỗi xảy ra khi export Excel!', true);
            }
        });

    </script>
</body>

</html>