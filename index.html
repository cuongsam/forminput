<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Nhập Hàng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container-fluid">
        <!-- Floating Navigation Buttons -->
        <div class="floating-nav">
            <a href="#cart-header" class="nav-btn" title="Báo cáo">
                <i class="fas fa-chart-bar"></i>
            </a>
            <a href="#list-section" class="nav-btn" title="Danh sách đơn">
                <i class="fas fa-list"></i>
            </a>
            <button class="nav-btn" onclick="scrollToInputSection()" title="Tạo phiếu">
                <i class="fas fa-plus-circle"></i>
            </button>
        </div>

        <header>
            <h1><i class="fas fa-truck"></i>Phiếu nhập hàng</h1>
        </header>

        <div class="main-content">
            <div class="cart-header" id="cart-header">
                <div class="stats-control">
                    <label for="routeSelector">Chọn tuyến đường:</label>
                    <select id="routeSelector">
                        <option value="">-- Chọn tuyến đường --</option>
                    </select>
                </div>
                <div class="date-filter" id="dateFilter">
                    <label>Lọc theo ngày:</label>
                    <input type="date" id="fromDate" />
                    <span>đến</span>
                    <input type="date" id="toDate" />
                    <button onclick="orderManager.filterByDate()">Lọc</button>
                    <button onclick="orderManager.clearDateFilter()">Xóa</button>
                </div>
                <div class="cart-stats">
                    <div class="stat-card">
                        <h3>Tổng số đơn</h3>
                        <div class="stat-value" id="totalOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Tổng trọng lượng (kg)</h3>
                        <div class="stat-value" id="totalWeight">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Tổng số kiện</h3>
                        <div class="stat-value" id="totalVolume">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Tổng số phiếu</h3>
                        <div class="stat-value" id="totalTickets">0</div>
                    </div>
                </div>
            </div>

            <section class="list-section" id="list-section">
                <h2><i class="fas fa-list"></i> Danh Sách Đơn Hàng</h2>

                <div id="ordersTableContainer">
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>Ngày Tạo</th>
                                <th>Khách Hàng</th>
                                <th>Tuyến Đường</th>
                                <th>Số Phiếu</th>
                                <th>Tải Trọng</th>
                                <th>Tổng cước (VND)</th>
                                <th>QR Code</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dữ liệu sẽ được thêm động bằng JS -->
                        </tbody>
                    </table>

                    <div class="empty-state" id="emptyState">
                        <i class="fas fa-inbox"></i>
                        <h3>Chưa có đơn hàng nào</h3>
                        <p>Hãy bắt đầu bằng cách tạo đơn hàng mới</p>
                    </div>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Nút phân trang sẽ được thêm bằng JS -->
                </div>
            </section>

            <section class="input-section" id="input-section">
                <h2><i class="fas fa-plus-circle"></i> Nhập Phiếu Mới</h2>
                <form id="inputForm">
                    <div class="form-grid">
                        <!-- Hàng 1: Thông tin khách hàng và thông tin tuyến đường -->
                        <div class="form-section">
                            <div class="form-section2">
                                <h3><i class="fas fa-user"></i> Thông Tin Khách Hàng</h3>
                                <div class="form-row-2">
                                    <div class="form-group">
                                        <label for="customerInput" class="required-label">Khách Hàng:</label>
                                        <div class="autocomplete">
                                            <input type="text" id="customerInput" placeholder="Nhập tên khách hàng...">
                                            <div id="customerSuggestions" class="autocomplete-suggestions hidden"></div>
                                        </div>
                                        <input type="hidden" id="customer_id">
                                        <div class="error-message" id="customerError">Vui lòng nhập tên khách hàng</div>
                                    </div>

                                    <div class="form-group">
                                        <label for="storeInput">Cửa hàng/Chi nhánh:</label>
                                        <div class="autocomplete">
                                            <input type="text" id="storeInput"
                                                placeholder="Nhập tên cửa hàng/chi nhánh...">
                                            <div id="storeSuggestions" class="autocomplete-suggestions hidden"></div>
                                        </div>
                                        <input type="hidden" id="store_id">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="recipientInfo">Thông Tin Người Nhận:</label>
                                    <div class="recipient-row">
                                        <input type="text" id="recipientName" placeholder="Tên người nhận">
                                        <input type="text" id="recipientPhone" placeholder="Số điện thoại người nhận">
                                    </div>
                                    <div class="error-message" id="recipientError">Vui lòng nhập thông tin người nhận
                                        nếu không có store và không giao tận nơi</div>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="newCustomer">
                                    <label for="newCustomer">Khách hàng mới</label>
                                </div>

                                <div id="newCustomerForm" class="hidden">
                                    <div class="form-row-3">
                                        <div class="form-group">
                                            <input type="text" id="newName" placeholder="Tên khách hàng mới">
                                            <div class="error-message" id="newNameError">Vui lòng nhập tên khách hàng
                                                mới</div>
                                        </div>
                                        <div class="form-group">
                                            <input type="text" id="newAddress" placeholder="Địa chỉ">
                                        </div>
                                        <div class="form-group">
                                            <input type="text" id="newPhone" placeholder="Số điện thoại">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-route"></i> Thông Tin Tuyến Đường</h3>

                            <div class="form-group">
                                <label for="routeInput" class="required-label">Tuyến Đường:</label>
                                <div class="autocomplete">
                                    <input type="text" id="routeInput"
                                        placeholder="Nhập tuyến (ví dụ: HCM HN cho Hồ Chí Minh -> Hà Nội)">
                                    <div id="routeSuggestions" class="autocomplete-suggestions hidden"></div>
                                </div>
                                <input type="hidden" id="routeCode">
                                <input type="hidden" id="routeFrom">
                                <input type="hidden" id="routeTo">
                                <div class="error-message" id="routeError">Vui lòng nhập tuyến đường</div>
                            </div>

                            <div class="route-display hidden" id="routeDisplay">
                                <i class="fas fa-route"></i> Tuyến đường: <span id="routeText"></span>
                            </div>

                            <div class="form-row-2">
                                <div class="form-group">
                                    <label for="ticketNumberInput" class="required-label">Số phiếu:</label>
                                    <input type="text" id="ticketNumberInput" placeholder="Nhập số phiếu">
                                    <div class="error-message" id="ticketNumberInputError">Vui lòng nhập số phiếu</div>
                                </div>
                                <div class="form-group">
                                    <div class="freight-row">
                                        <label for="defaultFreight">Cước vận chuyển (VND):</label>
                                        <div class="freight-inputs">
                                            <input type="text" id="defaultFreight" class="money-input" placeholder="0">
                                            <div class="checkbox-group inline-checkbox">
                                                <input type="checkbox" id="minimalFee">
                                                <label for="minimalFee">Giá tối thiểu</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hàng 2: Lấy và giao tận nơi, Thông tin hàng hóa -->
                        <div class="form-section">
                            <div class="form-section1">
                                <div class="form-row-2">
                                    <!-- Lấy hàng tận nơi -->
                                    <div class="service-group">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="customPickup">
                                            <label for="customPickup">Lấy hàng tận nơi</label>
                                        </div>

                                        <div id="pickupAddress" class="hidden">
                                            <div class="form-group">
                                                <input type="text" id="pickupAddr" placeholder="Địa chỉ lấy hàng">
                                            </div>
                                            <div class="compact-grid">
                                                <div class="form-group">
                                                    <input type="text" id="pickupContact" placeholder="Người liên lạc">
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" id="pickupPhone" placeholder="Số điện thoại">
                                                </div>
                                            </div>
                                            <div class="fee-grid-2">
                                                <div class="form-group">
                                                    <label>Số lượng:</label>
                                                    <input type="text" id="pickupQuantity" class="number-input"
                                                        placeholder="Số lượng">
                                                </div>
                                                <div class="form-group">
                                                    <label>Đơn vị:</label>
                                                    <select id="pickupUnit">
                                                        <option value="Chuyến">Chuyến</option>
                                                        <option value="kg">Kg</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>Giá:</label>
                                                    <input type="text" id="pickupPrice" class="money-input"
                                                        placeholder="Giá">
                                                </div>
                                                <div class="form-group">
                                                    <label>Thành tiền:</label>
                                                    <input type="text" id="pickupTotal" class="money-input"
                                                        placeholder="Thành tiền" readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Giao hàng tận nơi -->
                                    <div class="service-group">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="customDelivery">
                                            <label for="customDelivery">Giao hàng tận nơi</label>
                                        </div>

                                        <div id="deliveryAddress" class="hidden">
                                            <div class="form-group">
                                                <input type="text" id="deliveryAddr" placeholder="Địa chỉ giao hàng">
                                            </div>
                                            <div class="compact-grid">
                                                <div class="form-group">
                                                    <input type="text" id="deliveryContact"
                                                        placeholder="Người liên lạc">
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" id="deliveryPhone" placeholder="Số điện thoại">
                                                </div>
                                            </div>
                                            <div class="fee-grid-2">
                                                <div class="form-group">
                                                    <label>Số lượng:</label>
                                                    <input type="text" id="deliveryQuantity" class="number-input"
                                                        placeholder="Số lượng">
                                                </div>
                                                <div class="form-group">
                                                    <label>Đơn vị:</label>
                                                    <select id="deliveryUnit">
                                                        <option value="Chuyến">Chuyến</option>
                                                        <option value="kg">Kg</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>Giá:</label>
                                                    <input type="text" id="deliveryPrice" class="money-input"
                                                        placeholder="Giá">
                                                </div>
                                                <div class="form-group">
                                                    <label>Thành tiền:</label>
                                                    <input type="text" id="deliveryTotal" class="money-input"
                                                        placeholder="Thành tiền" readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-box"></i> Thông Tin Hàng Hóa</h3>

                            <!-- Hàng Đông Lạnh -->
                            <div class="cargo-types-horizontal">
                                <!-- Hàng Đông Lạnh -->
                                <div class="cargo-type">
                                    <h4><i class="fas fa-snowflake"></i> Hàng Đông Lạnh</h4>
                                    <div class="cargo-inputs-compact">
                                        <div class="form-group">
                                            <label for="frozenPackages">Số kiện:</label>
                                            <input type="text" id="frozenPackages" class="number-input"
                                                placeholder="Số kiện">
                                        </div>
                                        <div class="form-group">
                                            <label for="frozenWeight">Tải trọng (kg/cbm):</label>
                                            <input type="text" id="frozenWeight" class="number-input"
                                                placeholder="Tải trọng">
                                        </div>
                                        <div class="form-group">
                                            <label for="frozenUnit">Đơn vị:</label>
                                            <input type="text" id="frozenUnit" placeholder="Đơn vị" value="kg">
                                        </div>
                                    </div>
                                </div>

                                <!-- Hàng Mát -->
                                <div class="cargo-type">
                                    <h4><i class="fas fa-thermometer-half"></i> Hàng Mát</h4>
                                    <div class="cargo-inputs-compact">
                                        <div class="form-group">
                                            <label for="coolPackages">Số kiện:</label>
                                            <input type="text" id="coolPackages" class="number-input"
                                                placeholder="Số kiện">
                                        </div>
                                        <div class="form-group">
                                            <label for="coolWeight">Tải trọng (kg/cbm):</label>
                                            <input type="text" id="coolWeight" class="number-input"
                                                placeholder="Tải trọng">
                                        </div>
                                        <div class="form-group">
                                            <label for="coolUnit">Đơn vị:</label>
                                            <input type="text" id="coolUnit" placeholder="Đơn vị" value="kg">
                                        </div>
                                    </div>
                                </div>

                                <!-- Hàng Khô -->
                                <div class="cargo-type">
                                    <h4><i class="fas fa-box"></i> Hàng Khô</h4>
                                    <div class="cargo-inputs-compact">
                                        <div class="form-group">
                                            <label for="dryPackages">Số kiện:</label>
                                            <input type="text" id="dryPackages" class="number-input"
                                                placeholder="Số kiện">
                                        </div>
                                        <div class="form-group">
                                            <label for="dryWeight">Tải trọng (kg/cbm):</label>
                                            <input type="text" id="dryWeight" class="number-input"
                                                placeholder="Tải trọng">
                                        </div>
                                        <div class="form-group">
                                            <label for="dryUnit">Đơn vị:</label>
                                            <input type="text" id="dryUnit" placeholder="Đơn vị" value="kg">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hàng 3: Chi tiết hàng hóa (full width) -->
                        <div class="form-section full-width-section">
                            <div class="form-section3">
                            <h3><i class="fas fa-info-circle"></i> Chi Tiết Hàng Hóa</h3>

                            <!-- Dynamic chi tiết for each cargo type -->
                            <div id="cargoDetailsContainer">
                                <!-- Will be populated dynamically -->
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="isQuarantine">
                                <label for="isQuarantine">Hàng thuộc diện kiểm dịch</label>
                            </div>

                            <div id="quarantineSection" class="quarantine-section hidden">
                                <h4>Thông tin kiểm dịch</h4>
                                <div class="quarantine-fields">
                                    <div class="form-group">
                                        <label for="quarantineCertificate">Số phiếu kiểm dịch:</label>
                                        <input type="text" id="quarantineCertificate" placeholder="Số phiếu">
                                    </div>
                                    <div class="form-group">
                                        <label for="quarantineFee">Phí kiểm dịch (VND):</label>
                                        <input type="text" id="quarantineFee" class="money-input" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="quarantineDate">Ngày kiểm dịch:</label>
                                        <input type="date" id="quarantineDate">
                                    </div>
                                </div>
                            </div>
                        </div>
</div>
                        <!-- Hàng 4: Tổng giá trị cước (full width) -->
                        <div class="form-section full-width-section">
                            <h3><i class="fas fa-calculator"></i> Tổng Giá Trị Cước</h3>
                            <div class="total-fee-container">
                                <div class="fee-summary">
                                    <div class="fee-item">
                                        <label>Tổng trọng lượng:</label>
                                        <div class="fee-value">
                                            <input type="text" id="totalWeightCalc" class="number-input" readonly
                                                placeholder="0">
                                            <span class="unit">kg</span>
                                        </div>
                                    </div>
                                    <div class="fee-item">
                                        <label>Tổng giá trị cước:</label>
                                        <div class="fee-value">
                                            <input type="text" id="totalFee" class="money-input" readonly
                                                placeholder="0">
                                            <span class="unit">VND</span>
                                        </div>
                                    </div>
                                    <div class="fee-item" id="quarantineFeeItem">
                                        <label>Phí kiểm dịch:</label>
                                        <div class="fee-value">
                                            <input type="text" id="quarantineFeeDisplay" class="money-input" readonly
                                                placeholder="0">
                                            <span class="unit">VND</span>
                                        </div>
                                    </div>
                                    <div class="fee-item highlight">
                                        <label>Số tiền thanh toán:</label>
                                        <div class="fee-value">
                                            <input type="text" id="paymentAmount" class="money-input"
                                                placeholder="Tự động tính">
                                            <span class="unit">VND</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="reset" class="btn btn-reset"><i class="fas fa-redo"></i> Làm Mới</button>
                        <button type="submit" class="btn btn-submit"><i class="fas fa-save"></i> Tạo Phiếu</button>
                        <button type="button" class="btn btn-warning hidden" id="cancelEdit"><i
                                class="fas fa-times"></i> Hủy chỉnh sửa</button>
                        <button type="button" class="btn btn-export" id="exportExcel"><i class="fas fa-file-excel"></i>
                            Export Excel</button>
                        <button type="button" class="btn btn-export" id="exportParkingList"><i
                                class="fas fa-file-excel"></i> Export Parking List</button>
                        <button type="button" class="btn btn-warning" id="clearData"><i class="fas fa-trash"></i> Xóa Dữ
                            Liệu</button>
                    </div>
                </form>
            </section>
        </div>
    </div>

    <!-- QR Modal -->
    <div class="modal-backdrop hidden" id="qrModalBackdrop">
        <div class="qr-modal">
            <div class="qr-modal-header" >
                <span id="qrModalTitle">Phiếu Thu</span>
                <div>
                    <button class="btn btn-warning" id="qrPrintBtn" title="In QR"><i class="fas fa-print"></i></button>
                    <button class="btn btn-reset" id="qrCloseBtn" title="Đóng">&times;</button>
                </div>
            </div>
            <div class="qr-modal-body" id="qrModalContent">
                <!-- Nội dung QR sẽ được thêm bằng JS -->
            </div>
        </div>
    </div>

    <div class="notification hidden" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">Phiếu hàng đã được tạo thành công!</span>
    </div>

    <script src="qrcode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="app.js"></script>
</body>

</html>